
@model IEnumerable<Bitcraft.ResourceFinder.Web.Models.Resource>
@{
    ViewData["Title"] = "Browse Resources";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var total = (int)(ViewBag.Total ?? 0);
    var page = (int)(ViewBag.Page ?? 1);
    var pageSize = (int)(ViewBag.PageSize ?? 20);
    var pages = (total + pageSize - 1) / pageSize;
    var types = ViewBag.Types as List<Bitcraft.ResourceFinder.Web.Models.TypeItem>;
    var biomes = ViewBag.Biomes as List<Bitcraft.ResourceFinder.Web.Models.Biome>;
    string? q = ViewBag.Query; int? tier = ViewBag.Tier; Guid? type = ViewBag.Type; Guid? biome = ViewBag.Biome; string? status = ViewBag.Status;
}
<div class="card p-3 mb-3">
  <form class="row g-2" method="get">
    <div class="col-md-3">
      <input name="q" value="@q" class="form-control" placeholder="Search by name" />
    </div>
    <div class="col-md-2">
      <select class="form-select" name="tier">
        <option value="">Tier</option>
        @for (int i = 1; i <= 10; i++) {
            <option value="@i" selected="@(tier==i)">@i</option>
        }
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" name="type">
        <option value="">Type</option>
        @foreach (var t in types) {
            <option value="@t.Id" selected="@(type==t.Id)">@t.Name</option>
        }
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" name="biome">
        <option value="">Biome</option>
        @foreach (var b in biomes) {
            <option value="@b.Id" selected="@(biome==b.Id)">@b.Name</option>
        }
      </select>
    </div>
    <div class="col-md-1">
      <select class="form-select" name="status">
        <option value="">Any</option>
        <option value="confirmed" selected="@(status=="confirmed")">Confirmed</option>
        <option value="unconfirmed" selected="@(status=="unconfirmed")">Unconfirmed</option>
      </select>
    </div>
    <div class="col-md-12">
      <button class="btn btn-primary">Apply</button>
      <a class="btn btn-secondary" href="/resources">Reset</a>
    </div>
  </form>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
@foreach (var r in Model) {
  <div class="col">
    <div class="card h-100">
      <img src="@(r.Img256Url ?? "/images/placeholder-256.webp")" class="card-img-top" alt="@r.Name" />
      <div class="card-body">
        <h5 class="card-title">@r.Name</h5>
        <p class="card-text mb-1"><strong>Tier:</strong> @r.Tier</p>
        <p class="card-text mb-1"><strong>Type:</strong> @r.Type?.Name</p>
        <p class="card-text mb-1"><strong>Biome:</strong> @r.Biome?.Name</p>
        @if (r.Status == Bitcraft.ResourceFinder.Web.Models.ResourceStatus.Unconfirmed) {
            <span class="badge badge-unconfirmed">Unconfirmed</span>
        } else {
            <span class="badge badge-confirmed">Confirmed</span>
        }
      </div>
    </div>
  </div>
}
</div>

@if (pages > 1) {
  <nav class="mt-3">
    <ul class="pagination">
      @for (int p = 1; p <= pages; p++) {
        <li class="page-item @(p==page? "active":"")">
          <a class="page-link" href="@Url.Action("Index", new { q, tier, type, biome, status, page = p })">@p</a>
        </li>
      }
    </ul>
  </nav>
}
